CCS PCH C Compiler, Version 4.140, 22098               25-ago-14 16:27

               Filename:   D:\Projetos\Encoder\main.lst

               ROM used:   998 bytes (3%)
                           Largest free fragment is 31770
               RAM used:   7 (0%) at main() level
                           20 (1%) worst case
               Stack:     3 locations

*
0000:  GOTO   02C2
.................... /* 
....................  * main.c 
....................  * 
....................  *  Created on: 05/03/2014 
....................  *      Author: cuki 
....................  */ 
....................  
.................... #include <18F45k20.h> 
.................... //////// Standard Header file for the PIC18F45K20 device //////////////// 
.................... #device PIC18F45K20 
.................... #list 
....................  
....................  
.................... #FUSES HS 
.................... #use delay(crystal=16MHz, clock=64MHz) 
*
0034:  CLRF   FEA
0036:  MOVLW  0D
0038:  MOVWF  FE9
003A:  MOVF   FEF,W
003C:  BZ    005A
003E:  MOVLW  14
0040:  MOVWF  01
0042:  CLRF   00
0044:  DECFSZ 00,F
0046:  BRA    0044
0048:  DECFSZ 01,F
004A:  BRA    0042
004C:  MOVLW  BF
004E:  MOVWF  00
0050:  DECFSZ 00,F
0052:  BRA    0050
0054:  BRA    0056
0056:  DECFSZ FEF,F
0058:  BRA    003E
005A:  RETURN 0
.................... #use rs232(baud=9600, xmit=PIN_C6, rcv=PIN_C7) 
....................  
.................... #define cmd_subir	1 
.................... #define cmd_descer	2 
.................... #define cmd_parar	3 
.................... #define bto_subir	PIN_B0 
.................... #define bto_descer	PIN_B1 
.................... #define pin_subir	PIN_D0 
.................... #define pin_descer	PIN_D1 
.................... #define debounce	100 
.................... #define	latencia	1000 
....................  
.................... short ctrl_bto; 
.................... short direction; 
....................  
.................... int m_cmd; 
....................  
.................... void parar() { 
.................... 	output_low(pin_subir); 
*
00DC:  BCF    F95.0
00DE:  BCF    F8C.0
.................... 	output_low(pin_descer); 
00E0:  BCF    F95.1
00E2:  BCF    F8C.1
.................... } 
00E4:  GOTO   010E (RETURN)
....................  
.................... void subir() { 
.................... 	output_low(pin_descer); 
*
00B8:  BCF    F95.1
00BA:  BCF    F8C.1
.................... 	delay_ms(10); 
00BC:  MOVLW  0A
00BE:  MOVWF  0D
00C0:  RCALL  0034
.................... 	output_high(pin_subir); 
00C2:  BCF    F95.0
00C4:  BSF    F8C.0
.................... } 
00C6:  GOTO   00FE (RETURN)
....................  
.................... void descer() { 
.................... 	output_low(pin_subir); 
00CA:  BCF    F95.0
00CC:  BCF    F8C.0
.................... 	delay_ms(10); 
00CE:  MOVLW  0A
00D0:  MOVWF  0D
00D2:  RCALL  0034
.................... 	output_high(pin_descer); 
00D4:  BCF    F95.1
00D6:  BSF    F8C.1
.................... } 
00D8:  GOTO   0106 (RETURN)
....................  
.................... int trata_bto(int cmd) { 
*
005C:  BSF    F93.0
005E:  BCF    0B.0
0060:  BTFSS  F81.0
0062:  BSF    0B.0
0064:  BSF    F93.1
0066:  BCF    0B.1
0068:  BTFSS  F81.1
006A:  BSF    0B.1
006C:  MOVFF  0A,0C
....................  
.................... 	short a = !input(bto_subir); 
.................... 	short b = !input(bto_descer); 
.................... 	int ret = cmd; 
....................  
.................... 	if (a ^ b) { 
0070:  MOVLW  00
0072:  BTFSC  0B.0
0074:  MOVLW  01
0076:  MOVWF  0E
0078:  MOVLW  00
007A:  BTFSC  0B.1
007C:  MOVLW  01
007E:  XORWF  0E,W
0080:  BZ    00A6
.................... 		delay_ms(debounce); 
0082:  MOVLW  64
0084:  MOVWF  0D
0086:  RCALL  0034
.................... 		if (a && ctrl_bto) { 
0088:  BTFSS  0B.0
008A:  BRA    0096
008C:  BTFSS  04.0
008E:  BRA    0096
.................... 			ret = cmd_subir; 
0090:  MOVLW  01
0092:  MOVWF  0C
.................... 		} else if (b && ctrl_bto) { 
0094:  BRA    00A2
0096:  BTFSS  0B.1
0098:  BRA    00A2
009A:  BTFSS  04.0
009C:  BRA    00A2
.................... 			ret = cmd_descer; 
009E:  MOVLW  02
00A0:  MOVWF  0C
.................... 		} 
.................... 		ctrl_bto = FALSE; 
00A2:  BCF    04.0
.................... 	} else if (!ctrl_bto) { 
00A4:  BRA    00B0
00A6:  BTFSC  04.0
00A8:  BRA    00B0
.................... 		ctrl_bto = TRUE; 
00AA:  BSF    04.0
.................... 		ret = cmd_parar; 
00AC:  MOVLW  03
00AE:  MOVWF  0C
.................... 	} 
....................  
.................... 	return ret; 
00B0:  MOVFF  0C,01
.................... } 
00B4:  GOTO   030C (RETURN)
....................  
.................... int trata_cmd(int cmd) { 
*
00E8:  MOVFF  0B,0C
....................  
.................... 	int ret = cmd; 
....................  
.................... 	switch (cmd) { 
00EC:  MOVF   0B,W
00EE:  XORLW  01
00F0:  BZ    00FC
00F2:  XORLW  03
00F4:  BZ    0104
00F6:  XORLW  01
00F8:  BZ    010C
00FA:  BRA    011A
.................... 	case cmd_subir: 
.................... 		subir(); 
00FC:  BRA    00B8
.................... 		ret = cmd_subir; 
00FE:  MOVLW  01
0100:  MOVWF  0C
.................... 		break; 
0102:  BRA    011A
.................... 	case cmd_descer: 
.................... 		descer(); 
0104:  BRA    00CA
.................... 		ret = cmd_descer; 
0106:  MOVLW  02
0108:  MOVWF  0C
.................... 		break; 
010A:  BRA    011A
.................... 	case cmd_parar: 
.................... 		parar(); 
010C:  BRA    00DC
.................... 		set_timer0(0); 
010E:  CLRF   FD7
0110:  CLRF   FD6
.................... 		set_timer1(0); 
0112:  CLRF   FCF
0114:  CLRF   FCE
.................... 		ret = cmd_parar; 
0116:  MOVLW  03
0118:  MOVWF  0C
.................... 		break; 
.................... 	default: 
.................... 	} 
....................  
.................... 	return ret; 
011A:  MOVFF  0C,01
.................... } 
011E:  GOTO   0316 (RETURN)
....................  
.................... int main(void) { 
*
02C2:  CLRF   FF8
02C4:  BCF    FD0.7
02C6:  CLRF   FEA
02C8:  CLRF   FE9
02CA:  BSF    FB8.3
02CC:  MOVLW  82
02CE:  MOVWF  FAF
02D0:  MOVLW  06
02D2:  MOVWF  FB0
02D4:  MOVLW  A6
02D6:  MOVWF  FAC
02D8:  MOVLW  90
02DA:  MOVWF  FAB
02DC:  MOVLW  00
02DE:  MOVWF  F7E
02E0:  BCF    FC1.4
02E2:  BCF    FC1.5
02E4:  MOVF   F7F,W
02E6:  ANDLW  E0
02E8:  MOVWF  F7F
02EA:  BCF    F79.5
02EC:  BCF    F79.4
02EE:  CLRF   F7A
02F0:  CLRF   F7B
....................  
.................... 	set_timer0(0); 
02F2:  CLRF   FD7
02F4:  CLRF   FD6
.................... 	set_timer1(0); 
02F6:  CLRF   FCF
02F8:  CLRF   FCE
....................  
.................... 	setup_timer_0(T0_EXT_H_TO_L | T0_DIV_1); 
02FA:  MOVLW  B8
02FC:  MOVWF  FD5
.................... 	setup_timer_1(T1_EXTERNAL | T1_DIV_BY_1); 
02FE:  MOVLW  87
0300:  MOVWF  FCD
....................  
.................... 	m_cmd = cmd_parar; 
0302:  MOVLW  03
0304:  MOVWF  05
....................  
.................... 	while (TRUE) { 
....................  
.................... 		m_cmd = trata_cmd(trata_bto(m_cmd)); 
0306:  MOVFF  05,0A
030A:  BRA    005C
030C:  MOVFF  01,0A
0310:  MOVFF  01,0B
0314:  BRA    00E8
0316:  MOVFF  01,05
....................  
.................... 		if (m_cmd == cmd_subir || m_cmd == cmd_descer) { 
031A:  DECFSZ 05,W
031C:  BRA    0320
031E:  BRA    0326
0320:  MOVF   05,W
0322:  SUBLW  02
0324:  BNZ   03D0
....................  
.................... 			long t0 = get_timer0(); 
.................... 			long t1 = get_timer1(); 
0326:  MOVF   FD6,W
0328:  MOVWF  06
032A:  MOVFF  FD7,07
032E:  MOVF   FCE,W
0330:  MOVWF  08
0332:  MOVFF  FCF,09
....................  
.................... 			direction = (t0 > t1); 
0336:  BCF    04.1
0338:  MOVF   09,W
033A:  SUBWF  07,W
033C:  BNC   0348
033E:  BNZ   0346
0340:  MOVF   06,W
0342:  SUBWF  08,W
0344:  BC    0348
0346:  BSF    04.1
....................  
.................... 			printf("Timer 0: %lu\n\r", t0); 
0348:  MOVLW  04
034A:  MOVWF  FF6
034C:  MOVLW  00
034E:  MOVWF  FF7
0350:  MOVLW  09
0352:  MOVWF  0B
0354:  RCALL  0122
0356:  MOVLW  10
0358:  MOVWF  FE9
035A:  MOVFF  07,0B
035E:  MOVFF  06,0A
0362:  RCALL  0142
0364:  MOVLW  0A
0366:  BTFSS  F9E.4
0368:  BRA    0366
036A:  MOVWF  FAD
036C:  MOVLW  0D
036E:  BTFSS  F9E.4
0370:  BRA    036E
0372:  MOVWF  FAD
.................... 			printf("Timer 1: %lu\n\r", t1); 
0374:  MOVLW  14
0376:  MOVWF  FF6
0378:  MOVLW  00
037A:  MOVWF  FF7
037C:  MOVLW  09
037E:  MOVWF  0B
0380:  RCALL  0122
0382:  MOVLW  10
0384:  MOVWF  FE9
0386:  MOVFF  09,0B
038A:  MOVFF  08,0A
038E:  RCALL  0142
0390:  MOVLW  0A
0392:  BTFSS  F9E.4
0394:  BRA    0392
0396:  MOVWF  FAD
0398:  MOVLW  0D
039A:  BTFSS  F9E.4
039C:  BRA    039A
039E:  MOVWF  FAD
.................... 			printf("Direction: %d\n\r", direction); 
03A0:  MOVLW  00
03A2:  BTFSC  04.1
03A4:  MOVLW  01
03A6:  MOVWF  0A
03A8:  MOVLW  24
03AA:  MOVWF  FF6
03AC:  MOVLW  00
03AE:  MOVWF  FF7
03B0:  MOVLW  0B
03B2:  MOVWF  0B
03B4:  RCALL  0122
03B6:  MOVFF  0A,0B
03BA:  MOVLW  18
03BC:  MOVWF  0C
03BE:  BRA    020E
03C0:  MOVLW  0A
03C2:  BTFSS  F9E.4
03C4:  BRA    03C2
03C6:  MOVWF  FAD
03C8:  MOVLW  0D
03CA:  BTFSS  F9E.4
03CC:  BRA    03CA
03CE:  MOVWF  FAD
.................... 		} 
....................  
.................... 		delay_ms(latencia); 
03D0:  MOVLW  04
03D2:  MOVWF  0A
03D4:  MOVLW  FA
03D6:  MOVWF  0D
03D8:  RCALL  0034
03DA:  DECFSZ 0A,F
03DC:  BRA    03D4
.................... 	} 
03DE:  BRA    0306
....................  
.................... 	return 0; 
03E0:  MOVLW  00
03E2:  MOVWF  01
.................... } 
03E4:  SLEEP 

Configuration Fuses:
   Word  1: C600   H4 FCMEN IESO
   Word  2: 1E1E   PUT BROWNOUT BORV18 NOWDT WDT32768
   Word  3: 8F00   CCP2C1 PBADEN LPT1OSC HFOFST MCLR
   Word  4: 0081   STVREN NOLVP NOXINST NODEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: E00F   NOWRT NOWRTC NOWRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB
