CCS PCH C Compiler, Version 4.140, 31805               25-fev-14 10:19

               Filename:   D:\Eletronica\Projetos\Encoder\encoder.lst

               ROM used:   1842 bytes (6%)
                           Largest free fragment is 30926
               RAM used:   45 (3%) at main() level
                           71 (5%) worst case
               Stack:     2 locations

*
0000:  GOTO   05E6
.................... /*Ligacao do Encoder 
....................  * 	MR - A 
....................  * 	VM - B 
....................  * 	LR - Z 
....................  * 	AM - VSS 
....................  * 	VD - VDD 
....................  */ 
....................  
.................... /*Quando encoder não programado: 
....................  * nr maximo de pulsos... 
....................  * no pino T0CLK : 128 
....................  * no pino EXT:	255 
....................  */ 
....................  
.................... #include <18F45k20.h> 
.................... //////// Standard Header file for the PIC18F45K20 device //////////////// 
.................... #device PIC18F45K20 
.................... #list 
....................  
....................  
.................... #FUSES H4 
.................... #use delay(crystal=16MHz, clock=64MHz) 
*
0022:  CLRF   FEA
0024:  MOVLW  2A
0026:  MOVWF  FE9
0028:  MOVF   FEF,W
002A:  BZ    0048
002C:  MOVLW  14
002E:  MOVWF  01
0030:  CLRF   00
0032:  DECFSZ 00,F
0034:  BRA    0032
0036:  DECFSZ 01,F
0038:  BRA    0030
003A:  MOVLW  BF
003C:  MOVWF  00
003E:  DECFSZ 00,F
0040:  BRA    003E
0042:  BRA    0044
0044:  DECFSZ FEF,F
0046:  BRA    002C
0048:  RETURN 0
.................... #use rs232(baud=9600, xmit=PIN_C6, rcv=PIN_C7) 
.................... #use i2c (slave,scl=PIN_C3,sda=PIN_C4,FORCE_HW,FAST=100000) 
....................  
.................... #define canalA		PIN_B0 
.................... #define canalB		PIN_B4 
.................... #define canalZ		PIN_B5 
.................... #define bto_sobe	PIN_D0 
.................... #define bto_desce	PIN_D1 
.................... #define bto_maual	PIN_A4 
.................... #define cmd_sobe	1 
.................... #define cmd_desce	2 
.................... #define cmd_manual	3 
.................... #define cmd_parar	4 
.................... #define debounce	100 
....................  
.................... short ctrl; 
.................... short trigger = FALSE; 
.................... int cont = 0; 
.................... char str[32]; 
....................  
.................... short check_bto(int bto) { 
.................... 	if (!input(bto)) { 
.................... 		delay_ms(debounce); 
.................... 		return !input(bto); 
.................... 	} 
.................... 	return FALSE; 
.................... } 
....................  
.................... int controle_btos(void) { 
.................... 	short a, b, c; 
.................... 	int ret = 0; 
....................  
.................... 	a = check_bto(bto_sobe); 
.................... 	b = check_bto(bto_desce); 
.................... 	c = check_bto(bto_maual); 
....................  
.................... 	if (a && ctrl) { 
.................... 		ctrl = FALSE; 
.................... 		strcpy(str, "Pressionado Bto\nSobe"); 
.................... 		ret = cmd_sobe; 
.................... 	} else if (b && ctrl) { 
.................... 		ctrl = FALSE; 
.................... 		strcpy(str, "Pressionado Bto\nDesce"); 
.................... 		ret = cmd_desce; 
.................... 	} else if (c && ctrl) { 
.................... 		ctrl = FALSE; 
.................... 		strcpy(str, "Pressionado Bto\nManual"); 
.................... 		ret = cmd_manual; 
.................... 	} else if (!(a || b || c) && !ctrl) { 
.................... 		ctrl = TRUE; 
.................... 		strcpy(str, "Botoes Soltos\n"); 
.................... 		ret = cmd_parar; 
.................... 	} 
....................  
.................... 	return ret; 
.................... } 
....................  
.................... //short f_trig(int pino) { 
.................... // 
.................... //} 
....................  
.................... int main(void) { 
*
05E6:  CLRF   FF8
05E8:  BCF    FD0.7
05EA:  CLRF   FEA
05EC:  CLRF   FE9
05EE:  BSF    FB8.3
05F0:  MOVLW  82
05F2:  MOVWF  FAF
05F4:  MOVLW  06
05F6:  MOVWF  FB0
05F8:  MOVLW  A6
05FA:  MOVWF  FAC
05FC:  MOVLW  90
05FE:  MOVWF  FAB
0600:  BSF    F94.3
0602:  BSF    F94.4
0604:  CLRF   FC8
0606:  MOVLW  36
0608:  MOVWF  FC6
060A:  BSF    FC5.0
060C:  BCF    04.1
060E:  CLRF   05
0610:  MOVLW  00
0612:  MOVWF  F7E
0614:  BCF    FC1.4
0616:  BCF    FC1.5
0618:  MOVF   F7F,W
061A:  ANDLW  E0
061C:  MOVWF  F7F
061E:  BCF    F79.5
0620:  BCF    F79.4
0622:  CLRF   F7A
0624:  CLRF   F7B
0626:  CLRF   26
....................  
.................... 	int cmd = 0; 
.................... 	long cont_timer1; 
....................  
.................... 	set_timer1(0); 
0628:  CLRF   FCF
062A:  CLRF   FCE
.................... 	setup_timer_1(T1_INTERNAL | T1_DIV_BY_1); 
062C:  MOVLW  85
062E:  MOVWF  FCD
.................... 	delay_ms(300); 
0630:  MOVLW  02
0632:  MOVWF  29
0634:  MOVLW  96
0636:  MOVWF  2A
0638:  RCALL  0022
063A:  DECFSZ 29,F
063C:  BRA    0634
....................  
.................... 	while (TRUE) { 
.................... 		cont_timer1 = get_timer1(); 
063E:  MOVF   FCE,W
0640:  MOVWF  27
0642:  MOVFF  FCF,28
.................... 		if (!input(canalZ)) { 
0646:  BSF    F93.5
0648:  BTFSC  F81.5
064A:  BRA    0654
.................... 			set_timer1(0); 
064C:  CLRF   FCF
064E:  CLRF   FCE
.................... 			cont_timer1 = 0; 
0650:  CLRF   28
0652:  CLRF   27
.................... 		} 
.................... 		printf("Timer 1: %lu\r\nAngulo: %.2f\n\r", cont_timer1, 
.................... 				(float) cont_timer1 / 1024 * 360); 
0654:  MOVFF  28,2A
0658:  MOVFF  27,29
065C:  BRA    004A
065E:  MOVFF  00,29
0662:  MOVFF  01,2A
0666:  MOVFF  02,2B
066A:  MOVFF  03,2C
066E:  MOVFF  03,30
0672:  MOVFF  02,2F
0676:  MOVFF  01,2E
067A:  MOVFF  00,2D
067E:  CLRF   34
0680:  CLRF   33
0682:  CLRF   32
0684:  MOVLW  89
0686:  MOVWF  31
0688:  BRA    0082
068A:  MOVFF  00,29
068E:  MOVFF  01,2A
0692:  MOVFF  02,2B
0696:  MOVFF  03,2C
069A:  MOVFF  03,3D
069E:  MOVFF  02,3C
06A2:  MOVFF  01,3B
06A6:  MOVFF  00,3A
06AA:  CLRF   41
06AC:  CLRF   40
06AE:  MOVLW  34
06B0:  MOVWF  3F
06B2:  MOVLW  87
06B4:  MOVWF  3E
06B6:  RCALL  01DE
06B8:  MOVFF  00,29
06BC:  MOVFF  01,2A
06C0:  MOVFF  02,2B
06C4:  MOVFF  03,2C
06C8:  MOVLW  04
06CA:  MOVWF  FF6
06CC:  MOVLW  00
06CE:  MOVWF  FF7
06D0:  MOVLW  09
06D2:  MOVWF  2D
06D4:  RCALL  02D0
06D6:  MOVLW  10
06D8:  MOVWF  FE9
06DA:  MOVFF  28,2E
06DE:  MOVFF  27,2D
06E2:  BRA    02F0
06E4:  MOVLW  10
06E6:  MOVWF  FF6
06E8:  MOVLW  00
06EA:  MOVWF  FF7
06EC:  MOVLW  0A
06EE:  MOVWF  2D
06F0:  RCALL  02D0
06F2:  MOVLW  89
06F4:  MOVWF  FE9
06F6:  MOVFF  2C,30
06FA:  MOVFF  2B,2F
06FE:  MOVFF  2A,2E
0702:  MOVFF  29,2D
0706:  MOVLW  02
0708:  MOVWF  31
070A:  BRA    0464
070C:  MOVLW  0A
070E:  BTFSS  F9E.4
0710:  BRA    070E
0712:  MOVWF  FAD
0714:  MOVLW  0D
0716:  BTFSS  F9E.4
0718:  BRA    0716
071A:  MOVWF  FAD
.................... 		delay_ms(1000); 
071C:  MOVLW  04
071E:  MOVWF  29
0720:  MOVLW  FA
0722:  MOVWF  2A
0724:  RCALL  0022
0726:  DECFSZ 29,F
0728:  BRA    0720
.................... 	} 
072A:  BRA    063E
....................  
.................... 	return 0; 
072C:  MOVLW  00
072E:  MOVWF  01
.................... } 
0730:  SLEEP 

Configuration Fuses:
   Word  1: C600   H4 FCMEN IESO
   Word  2: 1E1E   PUT BROWNOUT BORV18 NOWDT WDT32768
   Word  3: 8F00   CCP2C1 PBADEN LPT1OSC HFOFST MCLR
   Word  4: 0081   STVREN NOLVP NOXINST NODEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: E00F   NOWRT NOWRTC NOWRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB
